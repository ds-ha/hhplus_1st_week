# ν¬μΈνΈ μ„λΉ„μ¤ λ™μ‹μ„± μ μ–΄ λ¶„μ„

## π“ κ°μ”
ν„μ¬ κµ¬ν„λ ν¬μΈνΈ μ„λΉ„μ¤μ—λ” μ‚¬μ©μμ ν¬μΈνΈ μ¶©μ „/μ‚¬μ©μ— λ€ν• λ™μ‹μ„± μ μ–΄κ°€ κµ¬ν„λμ–΄ μμ

## π”’ λ™μ‹μ„± μ μ–΄ λ°©μ‹
Lock κΈ°λ° λ™μ‹μ„± μ μ–΄

## β¨ μ£Όμ” νΉμ§•
* μ‚¬μ©μλ³„ λ…λ¦½μ μΈ λ½
  * ConcurrentHashMapμΌλ΅ μ‚¬μ©μλ³„ ReentrantLock κ΄€λ¦¬
  * μ„λ΅ λ‹¤λ¥Έ μ‚¬μ©μμ νΈλμ­μ…μ€ λ…λ¦½μ  μ‹¤ν–‰

* νƒ€μ„μ•„μ›ƒ λ©”μ»¤λ‹μ¦ 
  * tryLock(timeout, unit) μ‚¬μ©μΌλ΅ λ°λ“λ½ λ°©μ§€ 
  * 5μ΄ νƒ€μ„μ•„μ›ƒμΌλ΅ λ¬΄ν• λ€κΈ° λ°©μ§€

* λ½ μ΅°μ • 
  * νΈλμ­μ…μ ν•µμ‹¬ λ¶€λ¶„λ§ λ½μΌλ΅ λ³΄νΈ 
  * λ¶ν•„μ”ν• λ€κΈ° μ‹κ°„ μµμ†ν™”

## π›΅οΈ κµ¬ν„λ μ•μ „μ¥μΉ
κ²€μ¦ λ΅μ§(PointValidator μΌλ¶€)

    @Component
    public class PointValidator {
        public void validateBalance(long currentAmount, long useAmount) {
            if (currentAmount < useAmount) {
                throw new InsufficientPointException();
            }
        }
    
        public void validateAmountOverflow(long current, long amount) {
            if (Long.MAX_VALUE - current < amount) {
                throw new IllegalArgumentException("μ¶©μ „ ν¬μΈνΈκ°€ λ„λ¬΄ ν½λ‹λ‹¤.");
            }
        }
    }

νΈλμ­μ… μ•μ „μ„±(PointService)

    try {
    if (!lockManager.tryLock(id, 5, TimeUnit.SECONDS)) {
        throw new RuntimeException("ν¬μΈνΈ μ²λ¦¬ μ¤‘ νƒ€μ„μ•„μ›ƒμ΄ λ°μƒν–μµλ‹λ‹¤.");
    }
    try {
        // νΈλμ­μ… λ΅μ§
    } finally {
        lockManager.unlock(id);
    }


## π€ μ„±λ¥ λ¶„μ„
μ¥μ 
1. λ†’μ€ λ™μ‹μ„±
   μ‚¬μ©μλ³„ λ…λ¦½μ  λ½μΌλ΅ κ°„μ„­ μµμ†ν™”
   μ „μ²΄ μ‹μ¤ν… μ²λ¦¬λ‰ ν–¥μƒ
2. μ•μ „μ„±
   λ½ νλ“/ν•΄μ μ λ…ν™•ν• μƒλ…μ£ΌκΈ°
   finally λΈ”λ΅μΌλ΅ ν™•μ‹¤ν• λ½ ν•΄μ 
3. ν™•μ¥μ„±
   ConcurrentHashMapμΌλ΅ λ™μ  μ‚¬μ©μ ν™•μ¥
   ν¨μ¨μ μΈ λ©”λ¨λ¦¬ κ΄€λ¦¬
## β οΈ μ μ¬μ  μ΄μ
* λ©”λ¨λ¦¬ μ‚¬μ© 
  * μ‚¬μ©μλ³„ Lock κ°μ²΄ μƒμ„± 
  * λ―Έμ‚¬μ© Lock κ°μ²΄ μ •λ¦¬ ν•„μ” 
* νƒ€μ„μ•„μ›ƒ μ„¤μ • 
  * 5μ΄ νƒ€μ„μ•„μ›ƒμ΄ μΌλ¶€ μƒν™©μ—μ„ λ¶€μ μ ν•  μ μμ 
  * μƒν™©λ³„ μµμ ν™” ν•„μ”
## π§ ν…μ¤νΈ μΌ€μ΄μ¤
1. λ™μ‹ ν¬μΈνΈ μ¶©μ „/μ‚¬μ©μ— λ€ν• ν…μ¤νΈ μΌ€μ΄μ¤
2. λ‹¤μ μ μ €κ°€ apiλ¥Ό μ”μ²­ν•  κ²½μ°μ— λ€λΉ„, μ΅°ν, μ¶©μ „, μ‚¬μ© μ¤λ λ“λ¥Ό μƒμ„± λ¬΄μ‘μ„λ΅ μ‹¤ν–‰   
## β… κ²€μ¦ ν•­λ©
1. λ™μ‹ μ¶©μ „ μ‹ κΈμ•΅ μ •ν™•μ„±
2. λ™μ‹ μ‚¬μ© μ‹ μ”μ•΅ μΌκ΄€μ„±
3. νΌν•© μ‘μ—… μ‹ λ°μ΄ν„° μ •ν•©μ„± 
## π”„ κ°μ„  μ μ•μ‚¬ν•­
1. Lock νƒ€μ„μ•„μ›ƒ μ„¤μ • μµμ ν™” 
2. λ―Έμ‚¬μ© Lock κ°μ²΄ μ •λ¦¬ λ©”μ»¤λ‹μ¦
3. μ‹¤ν¨ μ‹ μ¬μ‹λ„ λ΅μ§
---